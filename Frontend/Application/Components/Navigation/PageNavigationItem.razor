@namespace Hephaestus.Frontend.Application.Components

<RadzenCard Variant="Variant.Filled" ContextMenu=@(args => ShowContextMenu(args)) Style=@($"background-image: url({ButtonStains[Code]});") class=@($"navbutton{(Enabled ? "" : " disabled")}") code="@Code" @onclick="OnClick">
	<RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.Start" Gap="1rem" Style="height: 100%">
		<LordIcon Icon="@ButtonAnims[Code]" State="default" Anim="state" Trigger="hover-click" Stroke="bold" Size="70px" Target=".navbutton" />
		<RadzenText Text="@AppNames[Code]" Style="font-size: 18px" class="rz-m-0" />
	</RadzenStack>
</RadzenCard>

@code {

	[Parameter, EditorRequired]
	public string Code { get; set; } = default!;

	[Parameter]
	public bool Enabled { get; set; } = true;

	[Parameter]
	public EventCallback Callback { get; set; }

	private void OnClick() {

		NavigationManager.NavigateTo(AppPaths[Code]);

	}

	private void ShowContextMenu(MouseEventArgs args) {

		var favorited = UserService.Preferences.Favorites?.Contains(Code) ?? false;

		ContextMenuService.Open(args,
		new List<ContextMenuItem> {
			new ContextMenuItem(){ Text = AppTexts["0069"], Value = 1, Icon = "star", Disabled=(favorited) },
			new ContextMenuItem(){ Text = AppTexts["0070"], Value = 2, Icon = "star_outline", Disabled=(!favorited) }}, OnContextMenuClick);

	}

	private void OnContextMenuClick(MenuItemEventArgs args) {

		_ = args.Value switch {
			1 => AddFavoriteAsync(),
			_ => RemoveFavoriteAsync()
		}; ContextMenuService.Close();

	}

	private async Task AddFavoriteAsync() {

		if (UserService.Preferences.Favorites?.Length >= 99) {

			NotificationService.Notify(NotificationSeverity.Warning, AppTexts["0072"], AppTexts["0074"]);

		} else {

			await UserService.AddFavoriteAsync(Code, true);
			await Callback.InvokeAsync();

		}

	}

	private async Task RemoveFavoriteAsync() {

		await UserService.RemoveFavoriteAsync(Code, true);
		await Callback.InvokeAsync();

	}

}